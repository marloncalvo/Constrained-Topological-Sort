Topological sort, but with a few cool restrictions.
Check it out, see if you can find out what it's doing :)
